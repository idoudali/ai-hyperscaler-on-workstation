# AI-HOW Cloud Cluster Configuration for Kubespray
# This file configures Kubespray variables for the cloud cluster deployment

## Container Runtime
container_manager: containerd
containerd_version: "1.7.23"
containerd_storage_dir: "/var/lib/containerd"
containerd_state_dir: "/run/containerd"

## Kubernetes Version
kube_version: v1.28.0

## Network Plugin
kube_network_plugin: calico
calico_version: "v3.30.3"
calico_cni_version: "v3.30.3"
calico_policy_enabled: true
calico_mtu: 1440

## Service and Pod Networks
kube_service_addresses: 10.96.0.0/12
kube_pods_subnet: 10.244.0.0/16
kube_network_node_prefix: 24

## DNS Configuration
dns_mode: coredns
enable_nodelocaldns: true
nodelocaldns_ip: 169.254.25.10

## Ingress Controller
ingress_nginx_enabled: true
ingress_nginx_host_network: false
ingress_nginx_namespace: ingress-nginx

## Metrics Server
metrics_server_enabled: true
metrics_server_kubelet_insecure_tls: true
metrics_server_kubelet_preferred_address_types: "InternalIP"

## Node Configuration
kubelet_max_pods: 110
kube_read_only_port: 10255

## Python Interpreter
ansible_python_interpreter: /usr/bin/python3

## Kubeconfig
kubeconfig_localhost: true
kubectl_localhost: true

## Feature Gates
kube_feature_gates:
  - "CSIMigration=true"
  - "CSIMigrationAWS=true"

## System Configuration
system_reserved: true
system_memory_reserved: 512Mi
system_cpu_reserved: 500m

## Node Labels and Taints
# These are applied in post-deployment tasks, but documented here for reference
node_labels:
  control-plane:
    node-role.kubernetes.io/control-plane: ""
  cpu-worker:
    workload-type: "general"
  gpu-worker-1:
    workload-type: "inference"
    gpu-type: "rtx-a6000"
    inference-ready: "true"
  gpu-worker-2:
    workload-type: "inference"
    gpu-type: "tesla-t4"
    inference-ready: "true"

node_taints:
  control-plane:
    - key: node-role.kubernetes.io/control-plane
      effect: NoSchedule
  gpu-worker-1:
    - key: nvidia.com/gpu
      value: present
      effect: NoSchedule
  gpu-worker-2:
    - key: nvidia.com/gpu
      value: present
      effect: NoSchedule
