# {{ container_runtime_type | title }} Configuration File
# Generated by Ansible on {{ ansible_date_time.iso8601 }}
# Host: {{ inventory_hostname }}

# Allow SUID functionality
allow suid = {{ 'yes' if container_runtime_allow_suid else 'no' }}

# Allow PID namespace
allow pid ns = {{ 'yes' if container_runtime_allow_pid_namespace else 'no' }}

# Configuration file settings
config passwd = yes
config group = yes
config resolv_conf = yes

# User namespace settings
userns = yes
user bind control = yes

# Mount points
mount proc = yes
mount sys = yes
mount dev = yes
mount home = {{ 'yes' if container_runtime_mount_home else 'no' }}
mount tmp = {{ 'yes' if container_runtime_mount_tmp else 'no' }}
mount hostfs = {{ 'yes' if container_runtime_mount_hostfs else 'no' }}

# Bind paths
bind path = /etc/localtime
bind path = /etc/hosts

# Overlay filesystem
enable overlay = yes
enable underlay = no

# Mount slave
mount slave = yes

# Session directory
sessiondir max size = 16

# Container formats
allow container squashfs = {{ 'yes' if container_runtime_enable_squashfs else 'no' }}
allow container extfs = yes
allow container dir = yes

# Container limits
limit container owners =
limit container groups =

# Encryption
allow container encrypted = yes

# Network settings
allow net users =
allow net groups =
allow net networks =

# NVIDIA GPU support
always use nv = no

# Root capabilities
root default capabilities = full

# Logging
logging level = 1
logging format = "{{ container_runtime_type }}: %v %u %p %c %m %f %e %r %a %t %s %S %d %i %o %g %h %l %n %q %x %y %z %w %W %j %k %L %M %N %O %P %Q %R %T %U %V %X %Y %Z %A %B %C %D %E %F %G %H %I %J %K %L %M %N %O %P %Q %R %S %T %U %V %W %X %Y %Z"

# Cache directory
cache disabled = no
cache entries = 256
cache min time = 1m
cache max time = 1h

# Download concurrency
download concurrency = 3
download part size = 5242880
download buffer size = 32768

# Remote endpoint
remote = yes
remote config = {{ container_runtime_config_dir }}/remote.yaml

# Setuid helper
setuid helper = /usr/libexec/{{ container_runtime_type }}/bin/{{ container_runtime_type }}-suid

# Unprivileged installation
unprivileged install = yes
