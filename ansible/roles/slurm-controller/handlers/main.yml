# SLURM Controller Role - Handlers
# Service restart handlers for SLURM controller components
# Note: Service restarts are skipped during Packer builds to prevent build failures

- name: restart slurm services
  service:
    name: "{{ item }}"
    state: restarted
  loop:
    - slurmctld
    - slurmdbd
    - munge
  become: true
  listen: restart slurm services
  when: not (packer_build | default(false) | bool)
  failed_when: false # Don't fail deployment if restart fails - services will be started later

- name: restart slurmctld
  service:
    name: slurmctld
    state: restarted
  become: true
  when: not (packer_build | default(false) | bool)

- name: restart slurmdbd
  service:
    name: slurmdbd
    state: restarted
  become: true
  when: not (packer_build | default(false) | bool)

- name: restart munge
  service:
    name: munge
    state: restarted
  become: true
  when: not (packer_build | default(false) | bool)

- name: restart mariadb
  service:
    name: mariadb
    state: restarted
  become: true
  when: not (packer_build | default(false) | bool)

- name: reload systemd
  systemd:
    daemon_reload: true
  become: true
