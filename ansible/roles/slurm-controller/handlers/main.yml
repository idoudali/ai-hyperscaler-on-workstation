# SLURM Controller Role - Handlers
# Service restart handlers for SLURM controller components
# Note: Service restarts are skipped during Packer builds to prevent build failures

- name: restart slurm services
  systemd:
    name: "{{ item }}"
    state: restarted
  loop:
    - slurmctld
    - slurmdbd
    - munge
  become: true
  listen: restart slurm services
  when: not ((packer_build | default(false)) | bool)

- name: restart slurmctld
  systemd:
    name: slurmctld
    state: restarted
  become: true
  when: not ((packer_build | default(false)) | bool)

- name: restart slurmdbd
  include_tasks: ../tasks/restart-slurmdbd.yml
  when: not ((packer_build | default(false)) | bool)

- name: restart munge
  systemd:
    name: munge
    state: restarted
  become: true
  when: not ((packer_build | default(false)) | bool)

- name: restart mariadb
  systemd:
    name: mariadb
    state: restarted
  become: true
  when: not ((packer_build | default(false)) | bool)

- name: reload systemd
  systemd:
    daemon_reload: true
  become: true
