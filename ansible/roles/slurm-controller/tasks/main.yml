# SLURM Controller Role - Main Tasks
# This file orchestrates the main tasks for SLURM controller setup
# including package installation, configuration, MUNGE setup, and service management

# Install packages and create SLURM user first
- name: Include SLURM controller installation tasks
  include_tasks: install.yml
  tags:
    - slurm
    - slurm-controller
    - install

# Setup common SLURM directories after user creation
- name: Setup SLURM directories using common role
  ansible.builtin.import_role:
    name: slurm-common
    tasks_from: setup-directories
  vars:
    slurm_setup_directories: true
  tags:
    - slurm
    - slurm-controller
    - directories

- name: Include SLURM controller configuration tasks
  include_tasks: configure.yml
  tags:
    - slurm
    - slurm-controller
    - configure

- name: Setup MUNGE authentication using common role
  ansible.builtin.import_role:
    name: slurm-common
    tasks_from: setup-munge
  vars:
    slurm_setup_munge: true
  tags:
    - slurm
    - slurm-controller
    - munge
    - auth

- name: Include SLURM job accounting configuration tasks
  include_tasks: accounting.yml
  when:
    - not (packer_build | default(false))
    - setup_slurm_accounting | default(false)
  tags:
    - slurm
    - slurm-controller
    - accounting
    - database
