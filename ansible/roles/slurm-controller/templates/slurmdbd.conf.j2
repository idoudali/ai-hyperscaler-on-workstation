# SLURM Database Daemon (slurmdbd) Configuration
# Generated by Ansible for HPC SLURM deployment
# Task 017: Configure SLURM Job Accounting

#=============================================================================
# Database Configuration
#=============================================================================

# Storage type for accounting data
StorageType=accounting_storage/mysql

# Database host
StorageHost={{ slurm_database_host | default('localhost') }}

# Database port
StoragePort={{ slurm_database_port | default(3306) }}

# Database name
StorageLoc={{ slurm_database_name | default('slurm_acct_db') }}

# Database user
StorageUser={{ slurm_database_user | default('slurm') }}

# Database password
StoragePass={{ slurm_database_password | default('slurm') }}

#=============================================================================
# Service Configuration
#=============================================================================

# SLURM database daemon port
DbdPort={{ slurm_accounting_storage_port | default(6819) }}

# SLURM database daemon address
DbdAddr={{ slurm_accounting_storage_host | default('localhost') }}

# SLURM database daemon log file
DbdLogFile={{ slurm_accounting_log_file | default('/var/log/slurm/slurmdbd.log') }}

# SLURM database daemon state directory
StateSaveLocation={{ slurm_accounting_state_dir | default('/var/lib/slurm') }}

# SLURM database daemon user
SlurmUser={{ slurm_user | default('slurm') }}

#=============================================================================
# Authentication and Security
#=============================================================================

# Authentication type
AuthType={{ slurm_auth_type | default('auth/munge') }}

# Crypto type for secure communication
CryptoType={{ slurm_crypto_type | default('crypto/munge') }}

# MUNGE socket path
MungeSocket={{ munge_socket_path | default('/var/run/munge/munge.socket.2') }}

#=============================================================================
# Logging and Debugging
#=============================================================================

# Debug level (0=none, 1=error, 2=warn, 3=info, 4=debug)
DebugLevel={{ slurm_accounting_debug_level | default('3') }}

# Debug flags
DebugFlags={{ slurm_accounting_debug_flags | default('DB_ARCHIVE,DB_AS') }}

# Log file format
LogFileFormat={{ slurm_log_file_format | default('2') }}

#=============================================================================
# Performance and Reliability
#=============================================================================

# Archive data older than this many days
ArchiveEvents={{ slurm_accounting_archive_events | default('yes') }}

# Archive jobs older than this many days
ArchiveJobs={{ slurm_accounting_archive_jobs | default('yes') }}

# Archive steps older than this many days
ArchiveSteps={{ slurm_accounting_archive_steps | default('yes') }}

# Archive usage older than this many days
ArchiveUsage={{ slurm_accounting_archive_usage | default('yes') }}

# Archive purge after this many days
PurgeEventAfter={{ slurm_accounting_purge_event_after | default('12') }}

# Purge job after this many days
PurgeJobAfter={{ slurm_accounting_purge_job_after | default('12') }}

# Purge step after this many days
PurgeStepAfter={{ slurm_accounting_purge_step_after | default('12') }}

# Purge usage after this many days
PurgeUsageAfter={{ slurm_accounting_purge_usage_after | default('12') }}

#=============================================================================
# Connection and Timeout Settings
#=============================================================================

# Connection timeout
ConnectionTimeout={{ slurm_accounting_connection_timeout | default('300') }}

# Message timeout
MessageTimeout={{ slurm_message_timeout | default('10') }}

# TCP timeout
TCPTimeout={{ slurm_tcp_timeout | default('2') }}

#=============================================================================
# Job Accounting Configuration
#=============================================================================

# Track job completion
TrackWCKey={{ slurm_accounting_track_wckey | default('yes') }}

# Track job resources
TrackResources={{ slurm_accounting_track_resources | default('yes') }}

# Track job steps
TrackSteps={{ slurm_accounting_track_steps | default('yes') }}

# Track job usage
TrackUsage={{ slurm_accounting_track_usage | default('yes') }}

#=============================================================================
# Advanced Configuration
#=============================================================================

# Maximum number of database connections
MaxDBConnections={{ slurm_accounting_max_db_connections | default('0') }}

# Database connection retry count
DBConnRetryCount={{ slurm_accounting_db_conn_retry_count | default('0') }}

# Database connection retry delay
DBConnRetryDelay={{ slurm_accounting_db_conn_retry_delay | default('0') }}

# Database connection timeout
DBConnTimeout={{ slurm_accounting_db_conn_timeout | default('0') }}

#=============================================================================
# Security and Access Control
#=============================================================================

# Allow users to create accounts
AllowUsersToCreateAccounts={{ slurm_accounting_allow_users_create_accounts | default('no') }}

# Allow users to create clusters
AllowUsersToCreateClusters={{ slurm_accounting_allow_users_create_clusters | default('no') }}

# Allow users to create federations
AllowUsersToCreateFederations={{ slurm_accounting_allow_users_create_federations | default('no') }}

# Allow users to create qos
AllowUsersToCreateQos={{ slurm_accounting_allow_users_create_qos | default('no') }}

# Allow users to create resources
AllowUsersToCreateResources={{ slurm_accounting_allow_users_create_resources | default('no') }}

# Allow users to create wckeys
AllowUsersToCreateWckeys={{ slurm_accounting_allow_users_create_wckeys | default('no') }}

#=============================================================================
# Monitoring and Health Checks
#=============================================================================

# Health check interval
HealthCheckInterval={{ slurm_accounting_health_check_interval | default('0') }}

# Health check program
HealthCheckProgram={{ slurm_accounting_health_check_program | default('') }}

# Health check timeout
HealthCheckTimeout={{ slurm_accounting_health_check_timeout | default('0') }}

#=============================================================================
# Backup and Recovery
#=============================================================================

# Backup database
BackupDatabase={{ slurm_accounting_backup_database | default('no') }}

# Backup directory
BackupDir={{ slurm_accounting_backup_dir | default('/var/backup/slurm') }}

# Backup frequency
BackupFrequency={{ slurm_accounting_backup_frequency | default('0') }}

# Backup retention
BackupRetention={{ slurm_accounting_backup_retention | default('0') }}
