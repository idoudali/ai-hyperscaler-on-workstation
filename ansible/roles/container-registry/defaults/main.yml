---
# Container Registry Role - Default Variables
# Storage-agnostic container registry with configurable backend dependencies

# ========================================
# Storage Backend Configuration
# ========================================

# Storage backend selection (beegfs, nfs, local, custom)
container_registry_storage_backend: "beegfs"

# Storage backend dependency configuration
container_registry_storage_dependencies:
  beegfs:
    required_roles:
      - beegfs-client
    mount_point_var: "beegfs_client_mount_point"
    mount_check_cmd: "mount | grep beegfs"
    service_check_cmd: "systemctl is-active beegfs-client"
  nfs:
    required_roles:
      - nfs-client
    mount_point_var: "nfs_client_mount_point"
    mount_check_cmd: "mount | grep nfs"
    service_check_cmd: "systemctl is-active nfs-client"
  local:
    required_roles: []
    mount_point_var: "container_registry_local_mount_point"
    mount_check_cmd: "test -d"
    service_check_cmd: "true"

# ========================================
# Registry Path Configuration
# ========================================

# Base registry paths for different storage backends
container_registry_paths:
  beegfs: "/mnt/beegfs/containers"
  nfs: "/mnt/nfs/containers"
  local: "/opt/containers"
  custom: "{{ container_registry_custom_path | default('/opt/containers') }}"

# Legacy variables for backward compatibility
container_registry_on_beegfs: "{{ container_registry_storage_backend == 'beegfs' }}"
container_registry_beegfs_path: "{{ container_registry_paths.beegfs }}"
container_registry_local_path: "{{ container_registry_paths.local }}"

# Auto-detect storage backend and use appropriate path
container_registry_base_path: "{{ container_registry_paths[container_registry_storage_backend] }}"

# Registry subdirectories
container_registry_subdirs:
  - "ml-frameworks"      # Production ML frameworks
  - "custom-images"      # User custom containers
  - "base-images"        # Base/template images
  - ".registry"          # Registry metadata

# Registry permissions
container_registry_dir_mode: "0775"
container_registry_owner: "root"
container_registry_group: "slurm"

# Registry configuration
container_registry_config_dir: "{{ container_registry_base_path }}/.registry"
container_registry_config_file: "{{ container_registry_config_dir }}/config.yaml"
container_registry_catalog_file: "{{ container_registry_config_dir }}/catalog.yaml"

# Cross-node synchronization settings
container_registry_sync_enabled: true
container_registry_sync_method: "rsync"  # Options: rsync, nfs, shared-storage

# SLURM integration
container_registry_slurm_integration: true
container_registry_slurm_conf_dir: "/etc/slurm"

# Packer build flag - CRITICAL: Skip this role during Packer builds
packer_build: false

# Container runtime
container_runtime: "apptainer"  # Options: apptainer, singularity
