# SLURM Cgroup Configuration Template
# Generated by Ansible for HPC SLURM compute node deployment
# Task 022: SLURM Compute Node Configuration

#=============================================================================
# Cgroup Configuration for SLURM
#=============================================================================

# Constrain CPU cores to allocated resources
ConstrainCores={{ slurm_cgroup_constrain_cores | default('yes') }}

# Constrain RAM to allocated resources
ConstrainRAMSpace={{ slurm_cgroup_constrain_memory | default('yes') }}

# Constrain swap space
ConstrainSwapSpace={{ slurm_cgroup_constrain_swap | default('no') }}

# Constrain devices
ConstrainDevices={{ slurm_cgroup_constrain_devices | default('yes') }}

# Allowed devices (if ConstrainDevices=yes)
AllowedDevicesFile={{ slurm_cgroup_allowed_devices_file | default('/etc/slurm/cgroup_allowed_devices_file.conf') }}

# Allowed RAM percent per task
AllowedRAMSpace={{ slurm_cgroup_allowed_ram_space | default('100') }}

# Allowed swap percent per task
AllowedSwapSpace={{ slurm_cgroup_allowed_swap_space | default('0') }}

# Maximum RAM percent
MaxRAMPercent={{ slurm_cgroup_max_ram_percent | default('100') }}

# Maximum swap percent
MaxSwapPercent={{ slurm_cgroup_max_swap_percent | default('100') }}

# Minimum RAM space per node in MB
MinRAMSpace={{ slurm_cgroup_min_ram_space | default('30') }}

# Memory swap
MemorySwappiness={{ slurm_cgroup_memory_swappiness | default('0') }}

#=============================================================================
# Cgroup Directory Configuration
# Note: TaskAffinity and CgroupAutomount are deprecated in SLURM 24.x
#=============================================================================

# Cgroup mount point
CgroupMountpoint={{ slurm_cgroup_mountpoint | default('/sys/fs/cgroup') }}

# Cgroup plugin configuration
CgroupPlugin={{ slurm_cgroup_plugin | default('autodetect') }}

#=============================================================================
# Cgroup Release Agent
#=============================================================================

# Ignore system defaults for task/cgroup
IgnoreSystemd={{ slurm_cgroup_ignore_systemd | default('no') }}

# Ignore systemd on failure
IgnoreSystemdOnFailure={{ slurm_cgroup_ignore_systemd_on_failure | default('no') }}
